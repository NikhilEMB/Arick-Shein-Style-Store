{"version":3,"sources":["./src/app/location-map/location-map.page.html","./src/app/location-map/location-map.module.ts","./src/app/location-map/location-map.page.scss","./src/app/location-map/location-map.page.ts"],"names":[],"mappings":";;;;;;;;;AAAA,gjB;;;;;;;;;;;;;;;;;;;;;;ACAyC;AACM;AACF;AACU;AAEV;AAES;AAEtD,IAAM,MAAM,GAAW;IACrB;QACE,IAAI,EAAE,EAAE;QACR,SAAS,EAAE,kEAAe;KAC3B;CACF,CAAC;AAWF;IAAA;IAAoC,CAAC;IAAxB,qBAAqB;QATjC,8DAAQ,CAAC;YACR,OAAO,EAAE;gBACP,4DAAY;gBACZ,0DAAW;gBACX,0DAAW;gBACX,4DAAY,CAAC,QAAQ,CAAC,MAAM,CAAC;aAC9B;YACD,YAAY,EAAE,CAAC,kEAAe,CAAC;SAChC,CAAC;OACW,qBAAqB,CAAG;IAAD,4BAAC;CAAA;AAAH;;;;;;;;;;;;ACzBlC,wBAAwB,gBAAgB,iBAAiB,GAAG,qBAAqB,mBAAmB,GAAG,6CAA6C,2rB;;;;;;;;;;;;;;;;;;;;ACA3E;AAChB;AACmB;AACjB;AAO3D;IAoBE,yBACoB,KAAqB,EACrB,MAAc,EACd,MAAc,EACd,WAA8B,EAC9B,eAAgC;QALpD,iBAcc;QAbM,UAAK,GAAL,KAAK,CAAgB;QACrB,WAAM,GAAN,MAAM,CAAQ;QACd,WAAM,GAAN,MAAM,CAAQ;QACd,gBAAW,GAAX,WAAW,CAAmB;QAC9B,oBAAe,GAAf,eAAe,CAAiB;QAtBpD,sBAAiB,GAAY,KAAK,CAAC;QAEnC,sBAAiB,GAAQ,IAAI,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC;QAE3D,UAAK,GAAG;YACN,KAAK,EAAE;gBACL,GAAG,EAAE,wEAAW,CAAC,eAAe;gBAChC,UAAU,EAAE,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC;aACzC;YACD,GAAG,EAAE;gBACH,GAAG,EAAE,wEAAW,CAAC,oBAAoB;gBACrC,UAAU,EAAE,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC;aACzC;SACF,CAAC;QAGF,yBAAoB,GAAG,EAAE,CAAC;QAQZ,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,SAAS,CAAC,gBAAM;YACrC,IAAI,KAAI,CAAC,MAAM,CAAC,oBAAoB,EAAE,CAAC,MAAM,CAAC,KAAK,EAAE;gBACnD,KAAI,CAAC,OAAO,GAAG,KAAI,CAAC,MAAM,CAAC,oBAAoB,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC;gBACvE,KAAI,CAAC,iBAAiB,GAAG,KAAI,CAAC,MAAM,CAAC,oBAAoB,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,iBAAiB,CAAC;gBAC3F,KAAI,CAAC,cAAc,GAAG,KAAI,CAAC,MAAM,CAAC,oBAAoB,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,cAAc,CAAC;aACtF;QACH,CAAC,CAAC,CAAC;IACJ,CAAC;IACd,kCAAQ,GAAR;IACA,CAAC;IACK,yCAAe,GAArB;;;;;4BACE,qBAAM,IAAI,CAAC,cAAc,EAAE;;wBAA3B,SAA2B,CAAC;wBAC5B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;wBAC/D,IAAI,CAAC,uBAAuB,EAAE,CAAC;wBAC/B,UAAU,CAAC;4BACT,KAAI,CAAC,MAAM,CAAC,OAAO,CAAC,yCAAyC,EAAE,KAAI,CAAC,OAAO,CAAC,CAAC;wBAC/E,CAAC,EAAE,IAAI,CAAC,CAAC;;;;;KAEV;IACD,0CAAgB,GAAhB;QACE,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IACD,iDAAuB,GAAvB;QAAA,iBAKC;QAJC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,6CAA6C,EAAE,UAAC,QAAQ,EAAE,QAAQ;YACtF,KAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YACvC,KAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;QACzB,CAAC,CAAC,CAAC;IACL,CAAC;IACD,iCAAO,GAAP,UAAQ,GAAG,EAAE,GAAG;QACd,IAAI,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAC9C,IAAI,UAAU,GAAG;YACf,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,EAAE;YACR,SAAS,EAAE,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO;SACzC;QACD,IAAI,CAAC,GAAG,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;QAC1E,IAAI,CAAC,iBAAiB,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC;YAC1D,GAAG,EAAE,IAAI,CAAC,GAAG;SACd,CAAC,CAAC;QACH,IAAM,YAAY,GAAG;YACnB,GAAG,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG;YAC5B,GAAG,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG;SAC7B,CAAC;QACF,IAAI,CAAC,cAAc,CAAC,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,OAAO,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;IACvE,CAAC;IAED,uCAAa,GAAb,UAAc,QAAQ,EAAE,QAAQ;QAAhC,iBA0BC;QAzBC,IAAI,CAAC,iBAAiB,CAAC,UAAU,CAAC;YAChC,eAAe,EAAE,IAAI;SACtB,CAAC,CAAC;QACH,IAAM,OAAO,GAAG;YACd,MAAM,EAAE,EAAC,GAAG,EAAE,QAAQ,EAAE,GAAG,EAAE,QAAQ,EAAC;YACtC,WAAW,EAAE,EAAC,GAAG,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG,EAAC;YACzE,UAAU,EAAE,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC;SAC9C;QACD,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,OAAO,EAAE,UAAC,GAAG,EAAE,MAAM;YAEhD,IAAG,MAAM,IAAI,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAAE,EAAC;gBAC3C,KAAI,CAAC,iBAAiB,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;gBAC1C,KAAI,CAAC,0BAA0B,EAAE,CAAC;gBAClC,IAAM,aAAa,GAAG;oBACpB,GAAG,EAAE,QAAQ;oBACb,GAAG,EAAE,QAAQ;iBACd,CAAC;gBACF,KAAI,CAAC,gBAAgB,CAAC,aAAa,EAAE,KAAI,CAAC,KAAK,CAAC,KAAK,EAAE,OAAO,EAAE,KAAI,CAAC,GAAG,CAAC,CAAC;aAC3E;iBAAM;gBACH,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACrB,KAAI,CAAC,YAAY,CAAC,oEAAoE,CAAC,CAAC;gBACxF,KAAI,CAAC,MAAM,CAAC,WAAW,CAAC,6CAA6C,CAAC,CAAC;aAC1E;QAEL,CAAC,CAAC,CAAC;IACH,CAAC;IACD,0CAAgB,GAAhB,UAAiB,QAAQ,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG;QACzC,IAAI,MAAM,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YAChC,QAAQ,EAAE,QAAQ;YAClB,GAAG,EAAE,GAAG;YACR,IAAI,EAAE,IAAI;YACV,KAAK,EAAE,KAAK;SACf,CAAC,CAAC;QACH,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC3C,CAAC;IACC,wCAAc,GAAd,UAAe,QAAQ,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG;QACvC,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACnB,QAAQ,EAAE,QAAQ;YAClB,GAAG,EAAE,GAAG;YACR,IAAI,EAAE,IAAI;YACV,KAAK,EAAE,KAAK;SACf,CAAC,CAAC;IACP,CAAC;IACD,oDAA0B,GAA1B;QACE,KAAK,IAAI,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG,IAAI,CAAC,oBAAoB,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;YACrE,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;SAC/C;IACH,CAAC;IACK,wCAAc,GAApB;;;;;;wBACE,SAAI;wBAAW,qBAAM,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;gCAC3C,OAAO,EAAE,qBAAqB;gCAC9B,QAAQ,EAAE,IAAI;6BACf,CAAC;;wBAHF,GAAK,OAAO,GAAG,SAGb,CAAC;wBACH,qBAAM,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE;;wBAA5B,SAA4B,CAAC;;;;;KAC9B;IACK,sCAAY,GAAlB,UAAmB,GAAW;;;;;;4BACd,qBAAM,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC;4BAC9C,OAAO,EAAE,GAAG;4BACZ,eAAe,EAAE,KAAK;4BACtB,OAAO,EAAE,CAAC;oCACR,IAAI,EAAE,IAAI;oCACV,OAAO,EAAE;wCACP,IAAG,KAAI,CAAC,iBAAiB,EAAE;4CACzB,KAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,iBAAiB,CAAC,CAAC,CAAC;yCAC3C;6CAAM;4CACL,KAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC;yCACtC;oCACH,CAAC;iCACF,CAAC;yBACH,CAAC;;wBAbI,KAAK,GAAG,SAaZ;wBAEF,qBAAM,KAAK,CAAC,OAAO,EAAE;;wBAArB,SAAqB,CAAC;;;;;KACvB;IACC,6CAAmB,GAAnB;QACE,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,6CAA6C,CAAC,CAAC;IACzE,CAAC;;gBAhI0B,8DAAc;gBACb,sDAAM;gBACN,qDAAM;gBACD,gEAAiB;gBACb,8DAAe;;IAxBlB;QAAjC,+DAAS,CAAC,KAAK,EAAC,EAAC,MAAM,EAAE,KAAK,EAAC,CAAC;wEAAa,wDAAU;uDAAC;IAD9C,eAAe;QAL3B,+DAAS,CAAC;YACT,QAAQ,EAAE,kBAAkB;YAC5B,4JAAuC;;SAExC,CAAC;+EAsB2B,8DAAc;YACb,sDAAM;YACN,qDAAM;YACD,gEAAiB;YACb,8DAAe;OAzBzC,eAAe,CAsJ3B;IAAD,sBAAC;CAAA;AAtJ2B","file":"location-map-location-map-module-es5.js","sourcesContent":["module.exports = \"<ion-header>\\r\\n  <ion-toolbar class=\\\"toolbar\\\">\\r\\n    <ion-buttons slot=\\\"start\\\">\\r\\n      <ion-back-button defaultHref=\\\"user-order-history\\\" class=\\\"custom-back-button\\\" *ngIf=\\\"routeFromUserSide\\\"></ion-back-button>\\r\\n      <ion-back-button defaultHref=\\\"admin-orders\\\" class=\\\"custom-back-button\\\" *ngIf=\\\"!routeFromUserSide\\\"></ion-back-button>\\r\\n    </ion-buttons>\\r\\n    <ion-title text-center>Track Order</ion-title>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content>\\r\\n<div #map id=\\\"map\\\"></div>\\r\\n</ion-content>\\r\\n\"","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { LocationMapPage } from './location-map.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: LocationMapPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    RouterModule.forChild(routes)\r\n  ],\r\n  declarations: [LocationMapPage]\r\n})\r\nexport class LocationMapPageModule {}\r\n","module.exports = \"#map {\\n  width: 100%;\\n  height: 100%;\\n}\\n\\n.google-map-img {\\n  max-width: 12%;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvbG9jYXRpb24tbWFwL0M6XFxCV0ktQURNSU5TXFxTaGVpbi1BZG1pbi1Db2RlL3NyY1xcYXBwXFxsb2NhdGlvbi1tYXBcXGxvY2F0aW9uLW1hcC5wYWdlLnNjc3MiLCJzcmMvYXBwL2xvY2F0aW9uLW1hcC9sb2NhdGlvbi1tYXAucGFnZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0ksV0FBQTtFQUNBLFlBQUE7QUNDSjs7QURDQTtFQUNJLGNBQUE7QUNFSiIsImZpbGUiOiJzcmMvYXBwL2xvY2F0aW9uLW1hcC9sb2NhdGlvbi1tYXAucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiI21hcCB7XHJcbiAgICB3aWR0aDogMTAwJTtcclxuICAgIGhlaWdodDogMTAwJTtcclxuICAgIH1cclxuLmdvb2dsZS1tYXAtaW1ne1xyXG4gICAgbWF4LXdpZHRoOiAxMiU7XHJcbn0iLCIjbWFwIHtcbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMTAwJTtcbn1cblxuLmdvb2dsZS1tYXAtaW1nIHtcbiAgbWF4LXdpZHRoOiAxMiU7XG59Il19 */\"","import { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { Events, AlertController, LoadingController } from '@ionic/angular';\r\nimport { environment } from 'src/environments/environment';\r\ndeclare var google;\r\n@Component({\r\n  selector: 'app-location-map',\r\n  templateUrl: './location-map.page.html',\r\n  styleUrls: ['./location-map.page.scss'],\r\n})\r\nexport class LocationMapPage implements OnInit {\r\n  @ViewChild('map',{static: false}) mapElement: ElementRef;\r\n  agentId: any;\r\n  routeFromUserSide: boolean = false;\r\n  map: any;\r\n  directionsService: any = new google.maps.DirectionsService;\r\n  directionsDisplay: any;\r\n  icons = {\r\n    start: {\r\n      url: environment.deliveryBikeurl,\r\n      scaledSize: new google.maps.Size(40, 40)\r\n    },\r\n    end: {\r\n      url: environment.destinationMarkerUrl,\r\n      scaledSize: new google.maps.Size(30, 30)\r\n    }\r\n  };\r\n  deliveryLatLng: any;\r\n  loading: any;\r\n  deliveryAgentMarkers = [];\r\n  constructor(\r\n              private route: ActivatedRoute,\r\n              private router: Router,\r\n              private events: Events,\r\n              private loadingCtrl: LoadingController,\r\n              private alertController: AlertController) {\r\n\r\n                this.route.queryParams.subscribe(params => {\r\n                  if (this.router.getCurrentNavigation().extras.state) {\r\n                    this.agentId = this.router.getCurrentNavigation().extras.state.agentId;\r\n                    this.routeFromUserSide = this.router.getCurrentNavigation().extras.state.routeFromUserSide;\r\n                    this.deliveryLatLng = this.router.getCurrentNavigation().extras.state.deliveryLatLng;\r\n                  }\r\n                });\r\n               }\r\n  ngOnInit() {                 \r\n  }\r\n  async ionViewDidEnter() {\r\n    await this.presentLoading();\r\n    this.loadMap(this.deliveryLatLng.lat, this.deliveryLatLng.lng);\r\n    this.initializeSubscriptions();\r\n    setTimeout(() => {\r\n      this.events.publish('delivery:getLatestLatLngOfDeliveryAgent', this.agentId);\r\n    }, 1000);\r\n\r\n  } \r\n  ionViewWillLeave(){\r\n    this.removeSubscriptions();\r\n  }\r\n  initializeSubscriptions() {\r\n    this.events.subscribe('delivery:publishLatestLatLngOfDeliveryAgent', (agentLat, agentLng) => {\r\n      this.setRouteInMap(agentLat, agentLng);\r\n      this.loading.dismiss();\r\n    });\r\n  }\r\n  loadMap(lat, lng) {\r\n    let latLng = new google.maps.LatLng(lat, lng);\r\n    let mapOptions = {\r\n      center: latLng,\r\n      zoom: 13,\r\n      mapTypeId: google.maps.MapTypeId.ROADMAP\r\n    }\r\n    this.map = new google.maps.Map(this.mapElement.nativeElement, mapOptions);\r\n    this.directionsDisplay = new google.maps.DirectionsRenderer({\r\n      map: this.map\r\n    });\r\n    const userLocation = {\r\n      lat: this.deliveryLatLng.lat,\r\n      lng: this.deliveryLatLng.lng\r\n    };\r\n    this.makeUserMarker(userLocation, this.icons.end, \"title\", this.map);\r\n  }\r\n  \r\n  setRouteInMap(agentLat, agentLng) {\r\n    this.directionsDisplay.setOptions({\r\n      suppressMarkers: true\r\n    });\r\n    const request = {\r\n      origin: {lat: agentLat, lng: agentLng},\r\n      destination: {lat: this.deliveryLatLng.lat, lng: this.deliveryLatLng.lng},\r\n      travelMode: google.maps.TravelMode['DRIVING']\r\n    }\r\n    this.directionsService.route(request, (res, status) => {\r\n\r\n      if(status == google.maps.DirectionsStatus.OK){\r\n        this.directionsDisplay.setDirections(res);\r\n        this.removePreviousAgentMarkers();\r\n        const agentLocation = {\r\n          lat: agentLat,\r\n          lng: agentLng\r\n        };\r\n        this.makeAgentMarkers(agentLocation, this.icons.start, \"title\", this.map);\r\n      } else {\r\n          console.warn(status);\r\n          this.presentAlert(\"There is some problem in setting up route. Please try again later.\");\r\n          this.events.unsubscribe('delivery:publishLatestLatLngOfDeliveryAgent');\r\n      }\r\n\r\n  });\r\n  }\r\n  makeAgentMarkers(position, icon, title, map) {\r\n    let marker = new google.maps.Marker({\r\n        position: position,\r\n        map: map,\r\n        icon: icon,\r\n        title: title\r\n    });\r\n    this.deliveryAgentMarkers.push(marker);\r\n}\r\n  makeUserMarker(position, icon, title, map) {\r\n    new google.maps.Marker({\r\n        position: position,\r\n        map: map,\r\n        icon: icon,\r\n        title: title\r\n    });\r\n}\r\nremovePreviousAgentMarkers() {\r\n  for (let index = 0; index < this.deliveryAgentMarkers.length; index++) {\r\n    this.deliveryAgentMarkers[index].setMap(null);\r\n  }\r\n}\r\nasync presentLoading() {\r\n  this.loading = await this.loadingCtrl.create({\r\n    message: 'Initializing Map...',\r\n    duration: 5000\r\n  });\r\n  await this.loading.present();\r\n}\r\nasync presentAlert(msg: string) {\r\n  const alert = await this.alertController.create({\r\n    message: msg,\r\n    backdropDismiss: false,\r\n    buttons: [{\r\n      text: 'Ok',\r\n      handler: () => {\r\n        if(this.routeFromUserSide) {\r\n          this.router.navigate(['shop-categories']);\r\n        } else {\r\n          this.router.navigate(['admin-home']);\r\n        }\r\n      }\r\n    }]\r\n  });\r\n\r\n  await alert.present();\r\n}\r\n  removeSubscriptions() {\r\n    this.events.unsubscribe('delivery:publishLatestLatLngOfDeliveryAgent');\r\n  }\r\n}\r\n"],"sourceRoot":""}